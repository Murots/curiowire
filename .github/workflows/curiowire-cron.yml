# name: CurioWire Auto Article Generator

# on:
#   schedule:
#     - cron: "0 */8 * * *" # Hver 8. time
#   workflow_dispatch: # Mulig √• kj√∏re manuelt fra GitHub UI

# jobs:
#   trigger:
#     runs-on: ubuntu-latest
#     steps:
#       - name: üîë Trigger CurioWire Cron Endpoint
#         run: |
#           echo "Triggering https://curiowire.com/api/cron"
#           curl -X GET "https://curiowire.com/api/cron" \
#             -H "Authorization: Bearer ${{ secrets.CRON_SECRET_KEY }}"

name: CurioWire Auto Article Generator

on:
  schedule:
    - cron: "0 */8 * * *" # hver 8. time
  workflow_dispatch: # kan kj√∏res manuelt fra GitHub UI

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - name: üì¶ Checkout repo
        uses: actions/checkout@v4

      - name: üß∞ Set up Node
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: üì¶ Install dependencies
        run: npm ci

      - name: üöÄ Run CurioWire generator
        env:
          # === üß† OpenAI ===
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          OPENAI_ORG_ID: ${{ secrets.OPENAI_ORG_ID }}

          # === üîê Supabase (skrivetilgang) ===
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}

          # === üñºÔ∏è Image APIs ===
          NEXT_PUBLIC_UNSPLASH_ACCESS_KEY: ${{ secrets.NEXT_PUBLIC_UNSPLASH_ACCESS_KEY }}
          NEXT_PUBLIC_PEXELS_API_KEY: ${{ secrets.NEXT_PUBLIC_PEXELS_API_KEY }}

          # === üåê Base URL (for sitemap/SEO-ping) ===
          NEXT_PUBLIC_BASE_URL: ${{ secrets.NEXT_PUBLIC_BASE_URL }}

          # === ü§ñ Reddit Feeds ===
          REDDIT_CLIENT_ID: ${{ secrets.REDDIT_CLIENT_ID }}
          REDDIT_CLIENT_SECRET: ${{ secrets.REDDIT_CLIENT_SECRET }}
          REDDIT_USER_AGENT: ${{ secrets.REDDIT_USER_AGENT }}

        run: node scripts/generate.js
