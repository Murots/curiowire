# name: CurioWire Auto Article Generator

# on:
#   # schedule:
#   #   - cron: "0 */12 * * *" # hver 12. time
#   workflow_dispatch: # kan kj√∏res manuelt fra GitHub UI

# jobs:
#   generate:
#     runs-on: ubuntu-latest
#     environment: Production
#     steps:
#       - name: üì¶ Checkout repo
#         uses: actions/checkout@v4

#       - name: üß∞ Set up Node
#         uses: actions/setup-node@v4
#         with:
#           node-version: 20

#       - name: üì¶ Install dependencies
#         run: npm ci

#       - name: üöÄ Run CurioWire generator
#         env:
#           # === üß† OpenAI ===
#           OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
#           OPENAI_ORG_ID: ${{ secrets.OPENAI_ORG_ID }}

#           # === üîê Supabase (skrivetilgang) ===
#           SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
#           SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}

#           # === üñºÔ∏è Image APIs ===
#           NEXT_PUBLIC_UNSPLASH_ACCESS_KEY: ${{ secrets.NEXT_PUBLIC_UNSPLASH_ACCESS_KEY }}
#           NEXT_PUBLIC_PEXELS_API_KEY: ${{ secrets.NEXT_PUBLIC_PEXELS_API_KEY }}

#           # === üåê Base URL (for sitemap/SEO-ping) ===
#           NEXT_PUBLIC_BASE_URL: ${{ secrets.NEXT_PUBLIC_BASE_URL }}

#           # === ü§ñ Reddit Feeds ===
#           REDDIT_CLIENT_ID: ${{ secrets.REDDIT_CLIENT_ID }}
#           REDDIT_CLIENT_SECRET: ${{ secrets.REDDIT_CLIENT_SECRET }}
#           REDDIT_USER_AGENT: ${{ secrets.REDDIT_USER_AGENT }}

#         run: node scripts/generate.js

#       - name: üé¨ Schedule single video
#         run: node scripts/scheduleSingleVideo.js

#       - name: üé• Generate & post single video
#         run: node scripts/runSingleVideoPipeline.js

name: CurioWire Auto Article Generator

on:
  workflow_dispatch:
  # schedule:
  #   - cron: "0 */12 * * *"

concurrency:
  group: curiowire-production
  cancel-in-progress: false

jobs:
  generate:
    runs-on: ubuntu-latest
    timeout-minutes: 45
    environment: Production

    env:
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      OPENAI_ORG_ID: ${{ secrets.OPENAI_ORG_ID }}

      SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
      SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}

      FAL_KEY: ${{ secrets.FAL_KEY }}

      NEXT_PUBLIC_UNSPLASH_ACCESS_KEY: ${{ secrets.NEXT_PUBLIC_UNSPLASH_ACCESS_KEY }}
      NEXT_PUBLIC_PEXELS_API_KEY: ${{ secrets.NEXT_PUBLIC_PEXELS_API_KEY }}
      NEXT_PUBLIC_BASE_URL: ${{ secrets.NEXT_PUBLIC_BASE_URL }}

      REDDIT_CLIENT_ID: ${{ secrets.REDDIT_CLIENT_ID }}
      REDDIT_CLIENT_SECRET: ${{ secrets.REDDIT_CLIENT_SECRET }}
      REDDIT_USER_AGENT: ${{ secrets.REDDIT_USER_AGENT }}

      TIKTOK_ACCESS_TOKEN: ${{ secrets.TIKTOK_ACCESS_TOKEN }}
      INSTAGRAM_ACCESS_TOKEN: ${{ secrets.INSTAGRAM_ACCESS_TOKEN }}
      INSTAGRAM_BUSINESS_ID: ${{ secrets.INSTAGRAM_BUSINESS_ID }}
      YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
      YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
      YOUTUBE_REFRESH_TOKEN: ${{ secrets.YOUTUBE_REFRESH_TOKEN }}
      FACEBOOK_PAGE_ACCESS_TOKEN: ${{ secrets.FACEBOOK_PAGE_ACCESS_TOKEN }}
      FACEBOOK_PAGE_ID: ${{ secrets.FACEBOOK_PAGE_ID }}

    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20

      - run: npm ci

      - name: üì∞ Generate articles
        run: node scripts/generate.js

      - name: üé¨ Schedule single video
        run: node scripts/scheduleSingleVideo.js

      - name: üé• Generate & post single video
        run: node scripts/runSingleVideoPipeline.js
